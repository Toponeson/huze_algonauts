Spaghetti code, to be renewed
